/* Copyright (c) 2011-2012 Sean Bleier */
this.JSON||(this.JSON={}),function(){function f(a){return a<10?"0"+a:a}function quote(a){return escapable.lastIndex=0,escapable.test(a)?'"'+a.replace(escapable,function(a){var b=meta[a];return typeof b=="string"?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function str(a,b){var c,d,e,f,g=gap,h,i=b[a];i&&typeof i=="object"&&typeof i.toJSON=="function"&&(i=i.toJSON(a)),typeof rep=="function"&&(i=rep.call(b,a,i));switch(typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";gap+=indent,h=[];if(Object.prototype.toString.apply(i)==="[object Array]"){f=i.length;for(c=0;c<f;c+=1)h[c]=str(c,i)||"null";return e=h.length===0?"[]":gap?"[\n"+gap+h.join(",\n"+gap)+"\n"+g+"]":"["+h.join(",")+"]",gap=g,e}if(rep&&typeof rep=="object"){f=rep.length;for(c=0;c<f;c+=1)d=rep[c],typeof d=="string"&&(e=str(d,i),e&&h.push(quote(d)+(gap?": ":":")+e))}else for(d in i)Object.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&h.push(quote(d)+(gap?": ":":")+e));return e=h.length===0?"{}":gap?"{\n"+gap+h.join(",\n"+gap)+"\n"+g+"}":"{"+h.join(",")+"}",gap=g,e}}typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(a){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(a){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;typeof JSON.stringify!="function"&&(JSON.stringify=function(a,b,c){var d;gap="",indent="";if(typeof c=="number")for(d=0;d<c;d+=1)indent+=" ";else typeof c=="string"&&(indent=c);rep=b;if(!b||typeof b=="function"||typeof b=="object"&&typeof b.length=="number")return str("",{"":a});throw new Error("JSON.stringify")}),typeof JSON.parse!="function"&&(JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&typeof e=="object")for(c in e)Object.hasOwnProperty.call(e,c)&&(d=walk(e,c),d!==undefined?e[c]=d:delete e[c]);return reviver.call(a,b,e)}var j;text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),function(){function h(){try{return d in b&&b[d]}catch(a){return!1}}function i(){try{return e in b&&b[e]&&b[e][b.location.hostname]}catch(a){return!1}}var a={},b=window,c=b.document,d="localStorage",e="globalStorage",f="__storejs__",g;a.disabled=!1,a.set=function(a,b){},a.get=function(a){},a.remove=function(a){},a.clear=function(){},a.transact=function(b,c){var d=a.get(b);typeof d=="undefined"&&(d={}),c(d),a.set(b,d)},a.serialize=function(a){return JSON.stringify(a)},a.deserialize=function(a){return typeof a!="string"?undefined:JSON.parse(a)};if(h())g=b[d],a.set=function(b,c){if(c===undefined)return a.remove(b);g.setItem(b,a.serialize(c))},a.get=function(b){return a.deserialize(g.getItem(b))},a.remove=function(a){g.removeItem(a)},a.clear=function(){g.clear()};else if(i())g=b[e][b.location.hostname],a.set=function(b,c){if(c===undefined)return a.remove(b);g[b]=a.serialize(c)},a.get=function(b){return a.deserialize(g[b]&&g[b].value)},a.remove=function(a){delete g[a]},a.clear=function(){for(var a in g)delete g[a]};else if(c.documentElement.addBehavior){var j,k;try{k=new ActiveXObject("htmlfile"),k.open(),k.write('<script>document.w=window</script><iframe src="/favicon.ico"></frame>'),k.close(),j=k.w.frames[0].document,g=j.createElement("div")}catch(l){g=c.createElement("div"),j=c.body}function m(b){return function(){var c=Array.prototype.slice.call(arguments,0);c.unshift(g),j.appendChild(g),g.addBehavior("#default#userData"),g.load(d);var e=b.apply(a,c);return j.removeChild(g),e}}a.set=m(function(b,c,e){if(e===undefined)return a.remove(c);b.setAttribute(c,a.serialize(e)),b.save(d)}),a.get=m(function(b,c){return a.deserialize(b.getAttribute(c))}),a.remove=m(function(a,b){a.removeAttribute(b),a.save(d)}),a.clear=m(function(a){var b=a.XMLDocument.documentElement.attributes;a.load(d);for(var c=0,e;e=b[c];c++)a.removeAttribute(e.name);a.save(d)})}try{a.set(f,f),a.get(f)!=f&&(a.disabled=!0),a.remove(f)}catch(l){a.disabled=!0}typeof module!="undefined"?module.exports=a:typeof define=="function"&&define.amd?define(a):this.store=a}();var XRegExp;if(XRegExp)throw Error("can't load XRegExp twice in the same frame");(function(){function l(a,b){if(!XRegExp.isRegExp(a))throw TypeError("type RegExp expected");var c=a._xregexp;return a=XRegExp(a.source,m(a)+(b||"")),c&&(a._xregexp={source:c.source,captureNames:c.captureNames?c.captureNames.slice(0):null}),a}function m(a){return(a.global?"g":"")+(a.ignoreCase?"i":"")+(a.multiline?"m":"")+(a.extended?"x":"")+(a.sticky?"y":"")}function n(a,b,c,f){var g=e.length,h,i,j;d=!0;try{while(g--){j=e[g];if(c&j.scope&&(!j.trigger||j.trigger.call(f))){j.pattern.lastIndex=b,i=j.pattern.exec(a);if(i&&i.index===b){h={output:j.handler.call(f,i,c),match:i};break}}}}catch(k){throw k}finally{d=!1}return h}function o(a,b,c){if(Array.prototype.indexOf)return a.indexOf(b,c);for(var d=c||0;d<a.length;d++)if(a[d]===b)return d;return-1}XRegExp=function(a,c){var e=[],g=XRegExp.OUTSIDE_CLASS,h=0,i,j,m,o,p;if(XRegExp.isRegExp(a)){if(c!==undefined)throw TypeError("can't supply flags when constructing one RegExp from another");return l(a)}if(d)throw Error("can't call the XRegExp constructor within token definition functions");c=c||"",i={hasNamedCapture:!1,captureNames:[],hasFlag:function(a){return c.indexOf(a)>-1},setFlag:function(a){c+=a}};while(h<a.length)j=n(a,h,g,i),j?(e.push(j.output),h+=j.match[0].length||1):(m=f.exec.call(k[g],a.slice(h)))?(e.push(m[0]),h+=m[0].length):(o=a.charAt(h),o==="["?g=XRegExp.INSIDE_CLASS:o==="]"&&(g=XRegExp.OUTSIDE_CLASS),e.push(o),h++);return p=RegExp(e.join(""),f.replace.call(c,b,"")),p._xregexp={source:a,captureNames:i.hasNamedCapture?i.captureNames:null},p},XRegExp.version="1.5.0",XRegExp.INSIDE_CLASS=1,XRegExp.OUTSIDE_CLASS=2;var a=/\$(?:(\d\d?|[$&`'])|{([$\w]+)})/g,b=/[^gimy]+|([\s\S])(?=[\s\S]*\1)/g,c=/^(?:[?*+]|{\d+(?:,\d*)?})\??/,d=!1,e=[],f={exec:RegExp.prototype.exec,test:RegExp.prototype.test,match:String.prototype.match,replace:String.prototype.replace,split:String.prototype.split},g=f.exec.call(/()??/,"")[1]===undefined,h=function(){var a=/^/g;return f.test.call(a,""),!a.lastIndex}(),i=function(){var a=/x/g;return f.replace.call("x",a,""),!a.lastIndex}(),j=RegExp.prototype.sticky!==undefined,k={};k[XRegExp.INSIDE_CLASS]=/^(?:\\(?:[0-3][0-7]{0,2}|[4-7][0-7]?|x[\dA-Fa-f]{2}|u[\dA-Fa-f]{4}|c[A-Za-z]|[\s\S]))/,k[XRegExp.OUTSIDE_CLASS]=/^(?:\\(?:0(?:[0-3][0-7]{0,2}|[4-7][0-7]?)?|[1-9]\d*|x[\dA-Fa-f]{2}|u[\dA-Fa-f]{4}|c[A-Za-z]|[\s\S])|\(\?[:=!]|[?*+]\?|{\d+(?:,\d*)?}\??)/,XRegExp.addToken=function(a,b,c,d){e.push({pattern:l(a,"g"+(j?"y":"")),handler:b,scope:c||XRegExp.OUTSIDE_CLASS,trigger:d||null})},XRegExp.cache=function(a,b){var c=a+"/"+(b||"");return XRegExp.cache[c]||(XRegExp.cache[c]=XRegExp(a,b))},XRegExp.copyAsGlobal=function(a){return l(a,"g")},XRegExp.escape=function(a){return a.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},XRegExp.execAt=function(a,b,c,d){b=l(b,"g"+(d&&j?"y":"")),b.lastIndex=c=c||0;var e=b.exec(a);return d?e&&e.index===c?e:null:e},XRegExp.freezeTokens=function(){XRegExp.addToken=function(){throw Error("can't run addToken after freezeTokens")}},XRegExp.isRegExp=function(a){return Object.prototype.toString.call(a)==="[object RegExp]"},XRegExp.iterate=function(a,b,c,d){var e=l(b,"g"),f=-1,g;while(g=e.exec(a))c.call(d,g,++f,a,e),e.lastIndex===g.index&&e.lastIndex++;b.global&&(b.lastIndex=0)},XRegExp.matchChain=function(a,b){return function c(a,d){var e=b[d].regex?b[d]:{regex:b[d]},f=l(e.regex,"g"),g=[],h;for(h=0;h<a.length;h++)XRegExp.iterate(a[h],f,function(a){g.push(e.backref?a[e.backref]||"":a[0])});return d===b.length-1||!g.length?g:c(g,d+1)}([a],0)},RegExp.prototype.apply=function(a,b){return this.exec(b[0])},RegExp.prototype.call=function(a,b){return this.exec(b)},RegExp.prototype.exec=function(a){var b=f.exec.apply(this,arguments),c,d;if(b){!g&&b.length>1&&o(b,"")>-1&&(d=RegExp(this.source,f.replace.call(m(this),"g","")),f.replace.call(a.slice(b.index),d,function(){for(var a=1;a<arguments.length-2;a++)arguments[a]===undefined&&(b[a]=undefined)}));if(this._xregexp&&this._xregexp.captureNames)for(var e=1;e<b.length;e++)c=this._xregexp.captureNames[e-1],c&&(b[c]=b[e]);!h&&this.global&&!b[0].length&&this.lastIndex>b.index&&this.lastIndex--}return b},h||(RegExp.prototype.test=function(a){var b=f.exec.call(this,a);return b&&this.global&&!b[0].length&&this.lastIndex>b.index&&this.lastIndex--,!!b}),String.prototype.match=function(a){XRegExp.isRegExp(a)||(a=RegExp(a));if(a.global){var b=f.match.apply(this,arguments);return a.lastIndex=0,b}return a.exec(this)},String.prototype.replace=function(b,c){var d=XRegExp.isRegExp(b),e,g,h;return d&&typeof c.valueOf()=="string"&&c.indexOf("${")===-1&&i?f.replace.apply(this,arguments):(d?b._xregexp&&(e=b._xregexp.captureNames):b+="",typeof c=="function"?g=f.replace.call(this,b,function(){if(e){arguments[0]=new String(arguments[0]);for(var a=0;a<e.length;a++)e[a]&&(arguments[0][e[a]]=arguments[a+1])}return d&&b.global&&(b.lastIndex=arguments[arguments.length-2]+arguments[0].length),c.apply(null,arguments)}):(h=this+"",g=f.replace.call(h,b,function(){var b=arguments;return f.replace.call(c,a,function(a,c,d){if(!c){var g=+d;return g<=b.length-3?b[g]:(g=e?o(e,d):-1,g>-1?b[g+1]:a)}switch(c){case"$":return"$";case"&":return b[0];case"`":return b[b.length-1].slice(0,b[b.length-2]);case"'":return b[b.length-1].slice(b[b.length-2]+b[0].length);default:var f="";c=+c;if(!c)return a;while(c>b.length-3)f=String.prototype.slice.call(c,-1)+f,c=Math.floor(c/10);return(c?b[c]||"":"$")+f}})})),d&&b.global&&(b.lastIndex=0),g)},String.prototype.split=function(a,b){if(!XRegExp.isRegExp(a))return f.split.apply(this,arguments);var c=this+"",d=[],e=0,g,h;if(b===undefined||+b<0)b=Infinity;else{b=Math.floor(+b);if(!b)return[]}a=XRegExp.copyAsGlobal(a);while(g=a.exec(c)){if(a.lastIndex>e){d.push(c.slice(e,g.index)),g.length>1&&g.index<c.length&&Array.prototype.push.apply(d,g.slice(1)),h=g[0].length,e=a.lastIndex;if(d.length>=b)break}a.lastIndex===g.index&&a.lastIndex++}return e===c.length?(!f.test.call(a,"")||h)&&d.push(""):d.push(c.slice(e)),d.length>b?d.slice(0,b):d},XRegExp.addToken(/\(\?#[^)]*\)/,function(a){return f.test.call(c,a.input.slice(a.index+a[0].length))?"":"(?:)"}),XRegExp.addToken(/\((?!\?)/,function(){return this.captureNames.push(null),"("}),XRegExp.addToken(/\(\?<([$\w]+)>/,function(a){return this.captureNames.push(a[1]),this.hasNamedCapture=!0,"("}),XRegExp.addToken(/\\k<([\w$]+)>/,function(a){var b=o(this.captureNames,a[1]);return b>-1?"\\"+(b+1)+(isNaN(a.input.charAt(a.index+a[0].length))?"":"(?:)"):a[0]}),XRegExp.addToken(/\[\^?]/,function(a){return a[0]==="[]"?"\\b\\B":"[\\s\\S]"}),XRegExp.addToken(/^\(\?([imsx]+)\)/,function(a){return this.setFlag(a[1]),""}),XRegExp.addToken(/(?:\s+|#.*)+/,function(a){return f.test.call(c,a.input.slice(a.index+a[0].length))?"":"(?:)"},XRegExp.OUTSIDE_CLASS,function(){return this.hasFlag("x")}),XRegExp.addToken(/\./,function(){return"[\\s\\S]"},XRegExp.OUTSIDE_CLASS,function(){return this.hasFlag("s")})})(),window.PlateBackend=function(a){var b=this;b.placemat=a,this.Template=function(a,c,d){var e=b.getDefaultPluginLibrary();c=c||{},c.plugin_library=e;var f=new plate.Template(a,c,d);return f},this.getDefaultPluginLibrary=function(){if(arguments.callee._loaded)return arguments.callee._loaded;var a=new plate.libraries.Library,c=b.loader;return a.register("loader",c.getPlugin()),arguments.callee._loaded=a,a},this.render=function(a,b,c){return a.render(b,c)},this.loader={getPlugin:function(){var a=this;return function(b,c){a.lookup(b,c)}},lookup:function(a,c){var d=b.placemat.getTemplate(a);d!==undefined?c(null,d):c(new Error("Could not find '"+a+"'"))}}},function(a,b){function c(){}Placemat=function(a){var b,c=this,a=a||{};this.VERSION=[0,2,3],this.VERSION_STRING=this.VERSION.join(".");var d={prefix:"",backend:PlateBackend};for(b in d)d.hasOwnProperty(b)&&(this[b]=a[b]===undefined?d[b]:a[b]);this.backend_cls=this.backend,this.backend=new this.backend_cls(this),this.Templates={},this.Contexts={},this.TemplateDoesNotExist=function(a){this.message=a}};var d=Placemat.prototype;d.cache={set:function(a,b,c){var c=c===undefined?-1:c,d=this;this.handles=this.handles||{},a in this.handles&&clearTimeout(this.handles[a]),c===-1?store.set(a,b):c!==0&&(store.set(a,b),this.handles[a]=setTimeout(function(){a in d.handles&&delete d.handles[a],store.remove(a)},c*1e3))},get:function(a){return store.get(a)}},d.fetch=function(a){var c,d;if(b.isArray(a))for(c=0;c<a.length;c++)this.fetchTemplate(a[c]);else if(b.isPlainObject(a))for(d in a)a.hasOwnProperty(d)&&this.checkAndSet(a[d],d);else typeof a=="string"&&this.fetchTemplate(a)},d.fetchTemplate=function(a,c){var d=this.prefix+a,e=this;b.ajax({url:d,type:"GET",async:!1,success:function(b,d){typeof b=="string"?e.Templates[a]=new e.backend.Template(b):(e.Templates[a]=new e.backend.Template(b.template),this.cache.set(a,b)),typeof c=="function"&&c()},statusCode:{404:function(){e.Templates[a]=new e.TemplateDoesNotExist(a+" template not found")}}})},d.checkAndSet=function(a,b){var c=this.Templates[a];c===undefined&&(c=this.cache.get(a),c===undefined?this.fetchTemplate(a):c.hash!==b?this.fetchTemplate(a):this.Templates[a]=new this.backend.Template(c.template))},d.getTemplate=function(a,b){return this.checkAndSet(a,b),this.Templates[a]},d.render=function(a,d,e,f){function q(a){a?n(a):(l(),++p===e.length&&m())}var e=e||[{}];e=b.isArray(e)?e:[e];var f=f||{},g,h,i=0,j=b(a),k=f.render||j.data("render")||"replace",l=f.postRender||c,m=f.finished||c,n=f.error||c,o=this.Templates[d];if(o===undefined)throw new this.TemplateDoesNotExist("'"+d+'"" is the stuff of dreams and fancy; template does not exist');var p=0;for(i=0;i<e.length;i++)h="render_"+k,this[h]!==undefined&&this[h](j,o,e[i],q)},d.render_replace=function(a,b,c,d){this.backend.render(b,c,function(b,c){b&&d(b),a.html(c),d()})},d.render_prepend=function(a,c,d,e){this.backend.render(c,d,function(c,d){if(c)return e(c);a.prepend(b(d)),e()})},d.render_append=function(a,c,d,e){this.backend.render(c,d,function(c,d){if(c)return e(c);a.append(b(d)),e()})},d.render_sorted=function(a,c,d,e){var f=this,g,h=a.data("sortOn"),i=a.data("sortOrder"),j=a.data("dataType");i===undefined?i="desc":i=i.toLowerCase(),this.backend.render(c,d,function(c,d){if(c)return e(c);var g=b(d),k,l=a.children(),m,n=g.find(h),o=f.getElementValue(n,j);l.length===0&&a.append(g);for(var p=0,q=l.length;p<q;p++){k=b(l[p]),n=k.find(h),m=f.getElementValue(n,j);if(i==="asc"){if(o<m){g.insertBefore(k);break}p===l.length-1&&g.insertAfter(k)}else if(i==="desc"){if(o>m){g.insertBefore(k);break}p===l.length-1&&g.insertAfter(k)}}e()})},d.getElementValue=function(a,c){var a=b(a),d,e=a.text();switch(c){case"integer":d=parseInt(e);case"float":d=parseFloat(e);case"date":d=Date.parse(e);default:d=parseFloat(e),d=isNaN(d)?e:d}return d},a.Placemat=Placemat}(window,jQuery)